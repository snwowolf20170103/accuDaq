# Blockly MVP è®¾è®¡æ–¹æ¡ˆ

**åˆ›å»ºæ—¥æœŸ**: 2026-01-21
**çŠ¶æ€**: å·²æ‰¹å‡†ï¼Œå¼€å§‹å®æ–½

---

## ä¸€ã€è®¾è®¡å†³ç­–

| å†³ç­–é¡¹ | é€‰æ‹© |
|--------|------|
| Blockly å±•ç¤ºæ–¹å¼ | å¼¹çª—æ¨¡æ€æ¡† (80%å±å¹•å®½é«˜) |
| MVP ç§¯æœ¨èŒƒå›´ | æœ€å°é›†ï¼šè¯»å–è¾“å…¥ + è®¾ç½®è¾“å‡º + å†…ç½®é€»è¾‘/æ•°å­¦ |
| ä»£ç æ‰§è¡Œæ–¹å¼ | ç›´æ¥ exec()ï¼Œä¿¡ä»»ç”¨æˆ· |

---

## äºŒã€æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        React Flow ç”»å¸ƒ                           â”‚
â”‚                                                                  â”‚
â”‚  [MockDevice] â”€â”€â”€â–¶ [CustomScript] â”€â”€â”€â–¶ [CSVStorage]             â”‚
â”‚                          â”‚                                       â”‚
â”‚                    ç‚¹å‡»"ç¼–è¾‘é€»è¾‘"                                 â”‚
â”‚                          â–¼                                       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚         â”‚       Blockly å¼¹çª—ç¼–è¾‘å™¨            â”‚                  â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚
â”‚         â”‚  â”‚  å·¥å…·ç®±      â”‚ â”‚   ç”»å¸ƒ       â”‚  â”‚                  â”‚
â”‚         â”‚  â”‚ - é€»è¾‘      â”‚ â”‚              â”‚  â”‚                  â”‚
â”‚         â”‚  â”‚ - æ•°å­¦      â”‚ â”‚  [ç§¯æœ¨å—]    â”‚  â”‚                  â”‚
â”‚         â”‚  â”‚ - DAQä¸“ç”¨   â”‚ â”‚              â”‚  â”‚                  â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚
â”‚         â”‚              [ ä¿å­˜ ] [ å–æ¶ˆ ]      â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®æµ**ï¼š
1. ç”¨æˆ·åœ¨ Blockly ä¸­æ‹–æ‹½ç§¯æœ¨ â†’ è‡ªåŠ¨ç”Ÿæˆ Python ä»£ç 
2. ä¿å­˜æ—¶ï¼Œå°† `blocklyXml` å’Œ `generatedCode` å­˜å…¥èŠ‚ç‚¹å±æ€§
3. ç¼–è¯‘æ—¶ï¼ŒCustomScript èŠ‚ç‚¹çš„ä»£ç è¢«åµŒå…¥åˆ°ç”Ÿæˆçš„ Python è„šæœ¬ä¸­
4. è¿è¡Œæ—¶ï¼Œ`exec()` æ‰§è¡Œç”¨æˆ·å®šä¹‰çš„é€»è¾‘

---

## ä¸‰ã€å‰ç«¯å®ç°

### 3.1 CustomScript èŠ‚ç‚¹å®šä¹‰

```typescript
{
    type: 'custom_script',
    name: 'Custom Script',
    category: 'logic',
    icon: 'ğŸ§©',
    inputs: [
        { id: 'input1', name: 'Input 1', type: 'number' },
        { id: 'input2', name: 'Input 2', type: 'number' },
    ],
    outputs: [
        { id: 'output1', name: 'Output 1', type: 'number' },
    ],
    defaultProperties: {
        blocklyXml: '',
        generatedCode: '',
    },
}
```

### 3.2 Blockly å·¥å…·ç®±

| ç±»åˆ« | ç§¯æœ¨ | æ¥æº |
|------|------|------|
| é€»è¾‘ | if/elseã€æ¯”è¾ƒã€ä¸/æˆ–/é | Blockly å†…ç½® |
| æ•°å­¦ | æ•°å­—ã€å››åˆ™è¿ç®— | Blockly å†…ç½® |
| DAQ ä¸“ç”¨ | è¯»å–è¾“å…¥ã€è®¾ç½®è¾“å‡º | è‡ªå®šä¹‰ |

---

## å››ã€åç«¯å®ç°

### 4.1 CustomScript ç»„ä»¶

```python
def process(self):
    code = self.config.get('generatedCode', '')
    if code:
        exec_globals = {
            'get_input': self.get_input,
            'set_output': self.set_output,
        }
        exec(code, exec_globals)
```

### 4.2 ç”Ÿæˆä»£ç ç¤ºä¾‹

```python
if get_input("input1") > 30:
    set_output("output1", get_input("input1") * 2)
else:
    set_output("output1", get_input("input1"))
```

---

## äº”ã€æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
- `visual-editor/src/blocks/daqBlocks.ts`
- `visual-editor/src/components/BlocklyEditor.tsx`
- `visual-editor/src/components/BlocklyModal.tsx`
- `daq_core/components/custom_script.py`

### ä¿®æ”¹æ–‡ä»¶
- `visual-editor/package.json`
- `visual-editor/src/data/componentLibrary.ts`
- `visual-editor/src/components/PropertyPanel.tsx`
- `daq_core/compiler/codegen.py`

---

## å…­ã€é¢„è®¡å·¥æ—¶

çº¦ 3 å°æ—¶
