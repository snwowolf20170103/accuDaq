# accuDaq ç¬¬äºŒé˜¶æ®µå¼€å‘è§„åˆ’

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¥æœŸ**: 2026-01-21
**è§„åˆ’å‘¨æœŸ**: 8-12å‘¨

---

## ä¸€ã€ç°çŠ¶è¯„ä¼°ï¼šMVPéœ€æ±‚ vs å½“å‰å®ç°

### 1.1 æ•´ä½“å®Œæˆåº¦æ¦‚è§ˆ

| æ¨¡å— | MVPè¦æ±‚ | å½“å‰çŠ¶æ€ | å®Œæˆåº¦ |
|------|---------|---------|--------|
| **åŸºç¡€æ¶æ„** | ç‹¬ç«‹Webåº”ç”¨ | 80% |
| **å¯è§†åŒ–ç¼–è¾‘** | æ— é™ç”»å¸ƒ+æ‹–æ‹½+è¿çº¿ | âœ… å·²å®ç° | 90% |
| **ç¼–è¯‘å™¨** | .daq â†’ Python | âœ… å·²å®ç° | 95% |
| **ç»„ä»¶åº“** | 11ä¸ªæ ¸å¿ƒç»„ä»¶ | 6ä¸ªç»„ä»¶ | 55% |
| **è®¾å¤‡ç®¡ç†** | Modbus+Mock+é¢æ¿ | ä»…Mockè®¾å¤‡ | 30% |
| **UIè®¾è®¡å™¨** | æ‹–æ‹½å¼Dashboard | å›ºå®šå¸ƒå±€ | 40% |


### 1.2 å·²å®ŒæˆåŠŸèƒ½è¯¦æƒ…

#### âœ… å¯è§†åŒ–ç¼–è¾‘å™¨ (visual-editor/)
```
å·²å®ç°ï¼š
â”œâ”€â”€ App.tsx              # ä¸»åº”ç”¨ï¼ŒèŠ‚ç‚¹/è¾¹çŠ¶æ€ç®¡ç†
â”œâ”€â”€ ComponentLibrary.tsx # ç»„ä»¶æ‹–æ‹½é¢æ¿
â”œâ”€â”€ DAQNode.tsx          # è‡ªå®šä¹‰èŠ‚ç‚¹æ¸²æŸ“
â”œâ”€â”€ PropertyPanel.tsx    # å±æ€§ç¼–è¾‘é¢æ¿
â”œâ”€â”€ Toolbar.tsx          # å·¥å…·æ 
â””â”€â”€ Dashboard.tsx        # è¿è¡Œæ—¶ä»ªè¡¨ç›˜
```

#### âœ… ç¼–è¯‘å™¨æ¶æ„ (daq_core/compiler/)
```
å·²å®ç°ï¼š
â”œâ”€â”€ parser.py      # .daq JSONè§£æ â†’ DAQProject
â”œâ”€â”€ topology.py    # Kahnç®—æ³•æ‹“æ‰‘æ’åº
â”œâ”€â”€ codegen.py     # Pythonä»£ç ç”Ÿæˆ
â””â”€â”€ compiler.py    # ç¼–è¯‘å™¨ä¸»æµç¨‹
```

#### âœ… ç»„ä»¶ç³»ç»Ÿ (daq_core/components/)
| ç»„ä»¶ | ç±»å‹ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| MockDevice | Source | æ¨¡æ‹Ÿæ­£å¼¦/æ–¹æ³¢/éšæœºæ•°æ® | âœ… |
| MQTTClient | Comm | MQTTè®¢é˜… | âœ… |
| MQTTPublisher | Comm | MQTTå‘å¸ƒ | âœ… |
| MathOperation | Process | æ•°å­¦è¿ç®—(+-*/scale) | âœ… |
| Compare | Process | æ¯”è¾ƒé€»è¾‘(><==) | âœ… |
| CSVStorage | Sink | CSVæ•°æ®å­˜å‚¨ | âœ… |

#### âœ… Dashboardæ§ä»¶ (widgets/)
- LineChartWidget.tsx - å®æ—¶æ³¢å½¢å›¾
- GaugeWidget.tsx - ä»ªè¡¨ç›˜

### 1.3 ç¼ºå¤±åŠŸèƒ½åˆ†æ

#### âŒ MVPè¦æ±‚ä½†æœªå®ç°

| åŠŸèƒ½ | MVPæè¿° | å·®è· | ä¼˜å…ˆçº§ |
|------|---------|------|--------|
| **Modbus TCP** | å·¥ä¸šåè®®è¯»å– | æœªå®ç° | ğŸ”´é«˜ |
| **è®¾å¤‡ç®¡ç†é¢æ¿** | è®¾å¤‡åˆ—è¡¨/çŠ¶æ€æŒ‡ç¤º | æœªå®ç° | ğŸ”´é«˜ |
| **æ‹–æ‹½Dashboard** | æ‰€è§å³æ‰€å¾—è®¾è®¡ | å½“å‰å›ºå®šå¸ƒå±€ | ğŸ”´é«˜ |
| **LEDæŒ‡ç¤ºç¯** | çº¢/ç»¿çŠ¶æ€ç¯ | æœªå®ç° | ğŸŸ¡ä¸­ |
| **å¼€å…³æŒ‰é’®** | æ§åˆ¶ç±»æ§ä»¶ | æœªå®ç° | ğŸŸ¡ä¸­ |
| **æ•°å€¼è¾“å…¥æ¡†** | æ§åˆ¶ç±»æ§ä»¶ | æœªå®ç° | ğŸŸ¡ä¸­ |
| **é˜ˆå€¼æŠ¥è­¦ç»„ä»¶** | ç®€å•é˜ˆå€¼åˆ¤æ–­ | æœªå®ç° | ğŸŸ¡ä¸­ |
| **Debug Print** | è°ƒè¯•æ‰“å°ç»„ä»¶ | æœªå®ç° | ğŸŸ¡ä¸­ |
| **å…¨å±€å˜é‡** | UIå˜é‡ç»‘å®š | æœªå®ç° | ğŸŸ¡ä¸­ |
| **åŒæ¨¡å¼åˆ‡æ¢** | å¯è§†åŒ–â†’ä»£ç  | æœªå®ç° | ğŸŸ¡ä¸­ |
| **é«˜äº®æ‰§è¡Œ** | è°ƒè¯•æ•°æ®æµ | æœªå®ç° | ğŸŸ¢ä½ |


---

## äºŒã€ç¬¬äºŒé˜¶æ®µå¼€å‘ç›®æ ‡

### 2.1 æ ¸å¿ƒç›®æ ‡

**å®ç°MVPéªŒæ”¶æ ‡å‡†**ï¼šç”¨æˆ·èƒ½åœ¨10åˆ†é’Ÿå†…å®Œæˆæ¸©åº¦ç›‘æ§é¡¹ç›®ï¼š
1. âœ… æ–°å»º"æ¸©åº¦ç›‘æ§"é¡¹ç›®
2. âœ… æ·»åŠ è™šæ‹Ÿæ¸©åº¦ä¼ æ„Ÿå™¨
3. âœ… æ‹–å…¥é€»è¾‘èŠ‚ç‚¹ï¼ˆæ¸©åº¦>30åˆ¤æ–­ï¼‰
4. âœ… è®¾è®¡Dashboardï¼ˆæ³¢å½¢å›¾+æŠ¥è­¦ç¯ï¼‰
5. âœ… è¿è¡ŒæŸ¥çœ‹å®æ—¶æ•°æ®
6. âœ… å¯¼å‡ºCSVæ•°æ®

### 2.2 é˜¶æ®µåˆ’åˆ†

```
Phase 2.1 (Week 1-3)  â†’ è¡¥é½æ ¸å¿ƒç»„ä»¶ + è®¾å¤‡ç®¡ç†
Phase 2.2 (Week 4-6)  â†’ Dashboardè®¾è®¡å™¨å‡çº§
Phase 2.3 (Week 7-9)  â†’ VSCodeé›†æˆ + åŒæ¨¡å¼
Phase 2.4 (Week 10-12) â†’ AIè¾…åŠ© + è°ƒè¯•åŠŸèƒ½
```

---

## ä¸‰ã€è¯¦ç»†å¼€å‘è®¡åˆ’

### Phase 2.1ï¼šæ ¸å¿ƒç»„ä»¶ä¸è®¾å¤‡ç®¡ç†ï¼ˆWeek 1-3ï¼‰ğŸ”´

#### Week 1ï¼šè¡¥é½Process/Sinkç»„ä»¶

| ç»„ä»¶ | å·¥ä½œé‡ | å®ç°è¦ç‚¹ |
|------|--------|---------|
| ThresholdAlarm | 1å¤© | è¾“å…¥value+thresholdï¼Œè¾“å‡ºalarm(boolean) |
| DebugPrint | 0.5å¤© | è¾“å…¥anyï¼Œæ‰“å°åˆ°æ§åˆ¶å° |
| GlobalVariable | 1å¤© | è¯»å†™å…¨å±€å˜é‡ï¼Œæ”¯æŒUIç»‘å®š |
| DataBuffer | 1å¤© | æ•°æ®ç¼“å­˜ï¼Œæ”¯æŒå†å²æŸ¥è¯¢ |

**ThresholdAlarm å®ç°ç¤ºä¾‹**ï¼š
```python
# daq_core/components/threshold_alarm.py
@ComponentRegistry.register
class ThresholdAlarmComponent(ComponentBase):
    component_name = "ThresholdAlarm"

    def _setup_ports(self):
        self.add_input_port("value", PortType.NUMBER)
        self.add_input_port("threshold", PortType.NUMBER)
        self.add_output_port("alarm", PortType.BOOLEAN)
        self.add_output_port("value_out", PortType.NUMBER)

    def process(self):
        value = self.get_input("value")
        threshold = self.config.get("threshold", 30)

        if value is not None:
            alarm = value > threshold
            self.set_output("alarm", alarm)
            self.set_output("value_out", value)
```

**å‰ç«¯ç»„ä»¶å®šä¹‰**ï¼š
```typescript
// componentLibrary.ts æ–°å¢
{
    type: 'threshold_alarm',
    name: 'Threshold Alarm',
    category: 'logic',
    icon: 'ğŸš¨',
    inputs: [
        { id: 'value', name: 'Value', type: 'number' }
    ],
    outputs: [
        { id: 'alarm', name: 'Alarm', type: 'boolean' },
        { id: 'value_out', name: 'Value', type: 'number' }
    ],
    defaultProperties: {
        threshold: 30,
        compare_type: 'greater'
    }
}
```

#### Week 2ï¼šModbus TCPæ”¯æŒ

| ä»»åŠ¡ | å·¥ä½œé‡ | ä¾èµ– |
|------|--------|------|
| pymodbusé›†æˆ | 0.5å¤© | pip install pymodbus |
| ModbusClientç»„ä»¶ | 2å¤© | è¯»å–ä¿æŒå¯„å­˜å™¨ |
| è¿æ¥ç®¡ç† | 1å¤© | é‡è¿æœºåˆ¶ã€é”™è¯¯å¤„ç† |
| å‰ç«¯é…ç½®UI | 1å¤© | IP/ç«¯å£/å¯„å­˜å™¨é…ç½® |

**ModbusClient ç»„ä»¶**ï¼š
```python
# daq_core/components/modbus_client.py
from pymodbus.client import ModbusTcpClient

@ComponentRegistry.register
class ModbusClientComponent(ComponentBase):
    component_name = "ModbusClient"
    component_type = ComponentType.DEVICE

    def _setup_ports(self):
        self.add_output_port("value", PortType.NUMBER)
        self.add_output_port("connected", PortType.BOOLEAN)

    def start(self):
        super().start()
        self.client = ModbusTcpClient(
            self.config.get('host', '127.0.0.1'),
            port=self.config.get('port', 502)
        )
        self.client.connect()

    def process(self):
        if self.client.connected:
            register = self.config.get('register', 0)
            result = self.client.read_holding_registers(register, 1)
            if not result.isError():
                self.set_output("value", result.registers[0])
                self.set_output("connected", True)
```

#### Week 3ï¼šè®¾å¤‡ç®¡ç†é¢æ¿

**æ–°å¢ç»„ä»¶**ï¼š`DevicePanel.tsx`

```typescript
// visual-editor/src/components/DevicePanel.tsx
interface Device {
    id: string
    name: string
    type: 'mock' | 'modbus' | 'mqtt'
    status: 'connected' | 'disconnected' | 'connecting'
    config: Record<string, any>
}

const DevicePanel = () => {
    const [devices, setDevices] = useState<Device[]>([])

    return (
        <div className="device-panel">
            <h3>ğŸ“¡ è®¾å¤‡ç®¡ç†</h3>
            <button onClick={addDevice}>+ æ·»åŠ è®¾å¤‡</button>

            {devices.map(device => (
                <DeviceCard
                    key={device.id}
                    device={device}
                    onConnect={() => connectDevice(device.id)}
                    onDisconnect={() => disconnectDevice(device.id)}
                />
            ))}

            {/* å®æ—¶æ•°æ®ç›‘è§†çª—å£ */}
            <RawDataViewer selectedDevice={selectedDevice} />
        </div>
    )
}
```

**åŠŸèƒ½æ¸…å•**ï¼š
- [x] è®¾å¤‡åˆ—è¡¨æ˜¾ç¤º
- [x] æ·»åŠ /åˆ é™¤è®¾å¤‡
- [x] è¿æ¥/æ–­å¼€æŒ‰é’®
- [x] çŠ¶æ€æŒ‡ç¤ºç¯ (ğŸŸ¢/ğŸ”´/ğŸŸ¡)
- [x] Raw Data Viewerï¼ˆå®æ—¶æ•°æ®è¡¨æ ¼ï¼‰
- [x] è®¾å¤‡é…ç½®ç¼–è¾‘

---

### Phase 2.2ï¼šDashboardè®¾è®¡å™¨å‡çº§ï¼ˆWeek 4-6ï¼‰ğŸ”´

#### Week 4ï¼šGridå¸ƒå±€ç³»ç»Ÿ

**æŠ€æœ¯é€‰å‹**ï¼šreact-grid-layout

```bash
npm install react-grid-layout
```

**DashboardDesigner.tsx**ï¼š
```typescript
import GridLayout from 'react-grid-layout'

const DashboardDesigner = () => {
    const [layout, setLayout] = useState([
        { i: 'chart1', x: 0, y: 0, w: 6, h: 4 },
        { i: 'led1', x: 6, y: 0, w: 2, h: 2 }
    ])
    const [widgets, setWidgets] = useState<Widget[]>([])
    const [editMode, setEditMode] = useState(true)

    return (
        <div className="dashboard-designer">
            {/* å·¥å…·æ  */}
            <WidgetToolbar onAddWidget={addWidget} />

            {/* å¯æ‹–æ‹½ç½‘æ ¼ */}
            <GridLayout
                layout={layout}
                cols={12}
                rowHeight={60}
                onLayoutChange={setLayout}
                isDraggable={editMode}
                isResizable={editMode}
            >
                {widgets.map(widget => (
                    <div key={widget.id}>
                        <WidgetRenderer widget={widget} />
                    </div>
                ))}
            </GridLayout>

            {/* å±æ€§é¢æ¿ */}
            <WidgetPropertyPanel
                widget={selectedWidget}
                variables={availableVariables}
            />
        </div>
    )
}
```

#### Week 5ï¼šæ–°å¢Dashboardæ§ä»¶

| æ§ä»¶ | ç±»å‹ | åŠŸèƒ½ | å·¥ä½œé‡ |
|------|------|------|--------|
| LEDWidget | æ˜¾ç¤º | çº¢/ç»¿æŒ‡ç¤ºç¯ | 1å¤© |
| NumberDisplay | æ˜¾ç¤º | æ•°å­—æ˜¾ç¤ºæ¡† | 0.5å¤© |
| SwitchWidget | æ§åˆ¶ | å¼€å…³æŒ‰é’® | 1å¤© |
| NumberInput | æ§åˆ¶ | æ•°å€¼è¾“å…¥æ¡† | 1å¤© |
| ProgressBar | æ˜¾ç¤º | è¿›åº¦æ¡ | 0.5å¤© |

**LEDWidget å®ç°**ï¼š
```typescript
// widgets/LEDWidget.tsx
interface LEDWidgetProps {
    value: boolean
    label: string
    colorOn?: string   // é»˜è®¤ç»¿è‰²
    colorOff?: string  // é»˜è®¤çº¢è‰²
}

const LEDWidget = ({ value, label, colorOn = '#27ae60', colorOff = '#e74c3c' }: LEDWidgetProps) => {
    return (
        <div className="led-widget">
            <div
                className="led-indicator"
                style={{
                    width: 24,
                    height: 24,
                    borderRadius: '50%',
                    backgroundColor: value ? colorOn : colorOff,
                    boxShadow: value
                        ? `0 0 10px ${colorOn}`
                        : 'none'
                }}
            />
            <span className="led-label">{label}</span>
        </div>
    )
}
```

#### Week 6ï¼šå˜é‡ç»‘å®šç³»ç»Ÿ

**ç›®æ ‡**ï¼šæ§ä»¶å¯ä»¥ç»‘å®š"è®¾å¤‡å˜é‡"æˆ–"å…¨å±€å˜é‡"

```typescript
// å˜é‡ç»‘å®šæ•°æ®ç»“æ„
interface VariableBinding {
    type: 'device' | 'global' | 'node_output'
    path: string  // e.g., "mock_device.value" or "global.temperature"
}

// å˜é‡é€‰æ‹©å™¨ç»„ä»¶
const VariableSelector = ({ onSelect }: { onSelect: (binding: VariableBinding) => void }) => {
    const devices = useDevices()
    const globalVars = useGlobalVariables()
    const nodeOutputs = useNodeOutputs()

    return (
        <div className="variable-selector">
            <h4>é€‰æ‹©æ•°æ®æº</h4>

            <div className="section">
                <h5>ğŸ“¡ è®¾å¤‡å˜é‡</h5>
                {devices.map(d => (
                    <div key={d.id} onClick={() => onSelect({ type: 'device', path: `${d.id}.value` })}>
                        {d.name}.value
                    </div>
                ))}
            </div>

            <div className="section">
                <h5>ğŸ”— èŠ‚ç‚¹è¾“å‡º</h5>
                {nodeOutputs.map(n => (
                    <div key={n.path} onClick={() => onSelect({ type: 'node_output', path: n.path })}>
                        {n.label}
                    </div>
                ))}
            </div>

            <div className="section">
                <h5>ğŸ“¦ å…¨å±€å˜é‡</h5>
                {globalVars.map(v => (
                    <div key={v.name} onClick={() => onSelect({ type: 'global', path: v.name })}>
                        {v.name}
                    </div>
                ))}
            </div>
        </div>
    )
}
```

**Dashboardé…ç½®ä¿å­˜æ ¼å¼**ï¼š
```json
{
    "ui": {
        "widgets": [
            {
                "id": "widget-1",
                "type": "line_chart",
                "layout": { "x": 0, "y": 0, "w": 6, "h": 4 },
                "config": {
                    "title": "æ¸©åº¦æ›²çº¿",
                    "binding": {
                        "type": "node_output",
                        "path": "mock_device_1.value"
                    },
                    "color": "#4a90d9"
                }
            },
            {
                "id": "widget-2",
                "type": "led",
                "layout": { "x": 6, "y": 0, "w": 2, "h": 2 },
                "config": {
                    "label": "æŠ¥è­¦ç¯",
                    "binding": {
                        "type": "node_output",
                        "path": "threshold_alarm_1.alarm"
                    },
                    "colorOn": "#e74c3c",
                    "colorOff": "#27ae60"
                }
            }
        ]
    }
}
```

---

### Phase 2.3ï¼šVSCodeé›†æˆä¸åŒæ¨¡å¼ï¼ˆWeek 7-9ï¼‰ğŸŸ¡

#### Week 7-8ï¼šVSCodeæ‰©å±•æ ¸å¿ƒ

**ç›®å½•ç»“æ„**ï¼š
```
vscode-extension/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ extension.ts        # æ‰©å±•å…¥å£
â”‚   â”œâ”€â”€ webviewProvider.ts  # Webviewé¢æ¿ç®¡ç†
â”‚   â”œâ”€â”€ commands.ts         # å‘½ä»¤æ³¨å†Œ
â”‚   â””â”€â”€ projectManager.ts   # é¡¹ç›®æ–‡ä»¶ç®¡ç†
â”œâ”€â”€ webview/                # åµŒå…¥çš„Reactåº”ç”¨
â”‚   â””â”€â”€ (visual-editoræ„å»ºäº§ç‰©)
â””â”€â”€ package.json
```

**æ ¸å¿ƒå‘½ä»¤æ³¨å†Œ**ï¼š
```typescript
// extension.ts
export function activate(context: vscode.ExtensionContext) {
    // æ³¨å†Œå‘½ä»¤
    context.subscriptions.push(
        vscode.commands.registerCommand('accudaq.newProject', () => {
            createProject(context)
        }),
        vscode.commands.registerCommand('accudaq.openEditor', () => {
            openVisualEditor(context)
        }),
        vscode.commands.registerCommand('accudaq.compile', () => {
            compileProject()
        }),
        vscode.commands.registerCommand('accudaq.run', () => {
            runProject()
        }),
        vscode.commands.registerCommand('accudaq.switchMode', () => {
            toggleEditorMode()
        })
    )

    // æ³¨å†ŒWebview Provider
    context.subscriptions.push(
        vscode.window.registerWebviewViewProvider(
            'accudaq.visualEditor',
            new DAQEditorProvider(context.extensionUri)
        )
    )
}
```

**Webviewé€šä¿¡**ï¼š
```typescript
// webviewProvider.ts
class DAQEditorProvider implements vscode.WebviewViewProvider {
    resolveWebviewView(webviewView: vscode.WebviewView) {
        webviewView.webview.options = {
            enableScripts: true
        }

        // åŠ è½½Reactåº”ç”¨
        webviewView.webview.html = this.getHtmlContent()

        // ç›‘å¬æ¥è‡ªWebviewçš„æ¶ˆæ¯
        webviewView.webview.onDidReceiveMessage(message => {
            switch (message.type) {
                case 'save':
                    this.saveProject(message.data)
                    break
                case 'compile':
                    this.compileProject()
                    break
                case 'run':
                    this.runEngine()
                    break
            }
        })
    }
}
```

#### Week 9ï¼šåŒæ¨¡å¼åˆ‡æ¢

**æ¨¡å¼åˆ‡æ¢é€»è¾‘**ï¼š
```typescript
type EditorMode = 'visual' | 'code'

const ModeSwitch = () => {
    const [mode, setMode] = useState<EditorMode>('visual')

    const switchToCode = async () => {
        // 1. ç¼–è¯‘å½“å‰å¯è§†åŒ–é¡¹ç›®ç”Ÿæˆä»£ç 
        const code = await compileToCode()

        // 2. åœ¨VSCodeä¸­æ‰“å¼€ç”Ÿæˆçš„Pythonæ–‡ä»¶
        vscode.commands.executeCommand('vscode.open',
            vscode.Uri.file(generatedCodePath)
        )

        setMode('code')
    }

    return (
        <div className="mode-switch">
            <button
                className={mode === 'visual' ? 'active' : ''}
                onClick={() => setMode('visual')}
            >
                ğŸ“Š å¯è§†åŒ–æ¨¡å¼
            </button>
            <button
                className={mode === 'code' ? 'active' : ''}
                onClick={switchToCode}
            >
                ğŸ’» ä»£ç æ¨¡å¼
            </button>
        </div>
    )
}
```

**MVPé™åˆ¶è¯´æ˜**ï¼š
- âœ… æ”¯æŒï¼šå¯è§†åŒ– â†’ ä»£ç ï¼ˆå•å‘è½¬æ¢ï¼‰
- âŒ ä¸æ”¯æŒï¼šä»£ç  â†’ å¯è§†åŒ–ï¼ˆåå‘è½¬æ¢ç•™å¾…åç»­ç‰ˆæœ¬ï¼‰

---

### Phase 2.4ï¼šAIè¾…åŠ©ä¸è°ƒè¯•ï¼ˆWeek 10-12ï¼‰ğŸŸ¢

#### Week 10-11ï¼šAI Chaté›†æˆ

**ä¾§è¾¹æ Chatçª—å£**ï¼š
```typescript
// components/AIChat.tsx
const AIChat = () => {
    const [messages, setMessages] = useState<Message[]>([])
    const [input, setInput] = useState('')

    const sendMessage = async () => {
        // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
        const userMsg = { role: 'user', content: input }
        setMessages([...messages, userMsg])

        // è°ƒç”¨LLM API
        const response = await fetch('/api/ai/chat', {
            method: 'POST',
            body: JSON.stringify({
                message: input,
                context: {
                    components: availableComponents,
                    project: currentProject
                }
            })
        })

        const result = await response.json()
        setMessages([...messages, userMsg, { role: 'assistant', content: result.reply }])
        setInput('')
    }

    return (
        <div className="ai-chat">
            <div className="messages">
                {messages.map((msg, i) => (
                    <div key={i} className={`message ${msg.role}`}>
                        {msg.content}
                    </div>
                ))}
            </div>
            <div className="input-area">
                <input
                    value={input}
                    onChange={e => setInput(e.target.value)}
                    placeholder="é—®æˆ‘ä»»ä½•é—®é¢˜..."
                />
                <button onClick={sendMessage}>å‘é€</button>
            </div>
        </div>
    )
}
```

**åç«¯AIæœåŠ¡**ï¼š
```python
# api/ai_service.py
from openai import OpenAI  # æˆ–ä½¿ç”¨ Anthropic

SYSTEM_PROMPT = """
ä½ æ˜¯accuDaqæ•°æ®é‡‡é›†ç³»ç»Ÿçš„AIåŠ©æ‰‹ã€‚

å¯ç”¨ç»„ä»¶ï¼š
- MockDevice: æ¨¡æ‹Ÿæ•°æ®æºï¼ˆæ­£å¼¦/æ–¹æ³¢/éšæœºï¼‰
- ModbusClient: Modbus TCPè®¾å¤‡è¯»å–
- MathOperation: æ•°å­¦è¿ç®—
- ThresholdAlarm: é˜ˆå€¼æŠ¥è­¦
- CSVStorage: CSVæ•°æ®å­˜å‚¨

ä½ å¯ä»¥ï¼š
1. è§£é‡Šä»£ç å«ä¹‰
2. ç”Ÿæˆç®€å•çš„Pythonè„šæœ¬
3. æ¨èé€‚åˆçš„ç»„ä»¶

è¯·æä¾›ç®€æ´ã€å¯æ‰§è¡Œçš„ä»£ç ç¤ºä¾‹ã€‚
"""

def chat(message: str, context: dict) -> str:
    client = OpenAI()
    response = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": SYSTEM_PROMPT},
            {"role": "user", "content": message}
        ]
    )
    return response.choices[0].message.content
```

#### Week 12ï¼šè°ƒè¯•åŠŸèƒ½

**é«˜äº®æ‰§è¡Œæ¨¡å¼**ï¼š
```typescript
// è°ƒè¯•çŠ¶æ€ç®¡ç†
interface DebugState {
    isDebugging: boolean
    currentNodeId: string | null
    portValues: Record<string, Record<string, any>>
    speed: 'slow' | 'normal' | 'fast'
}

const DebugOverlay = ({ nodeId, portValues }: { nodeId: string, portValues: Record<string, any> }) => {
    return (
        <div className="debug-overlay">
            {Object.entries(portValues).map(([port, value]) => (
                <div key={port} className="port-value">
                    <span className="port-name">{port}:</span>
                    <span className="port-data">{JSON.stringify(value)}</span>
                </div>
            ))}
        </div>
    )
}

// èŠ‚ç‚¹é«˜äº®æ ·å¼
const nodeStyle = (isExecuting: boolean) => ({
    border: isExecuting ? '3px solid #f39c12' : '1px solid #333',
    boxShadow: isExecuting ? '0 0 15px rgba(243, 156, 18, 0.5)' : 'none',
    animation: isExecuting ? 'pulse 1s infinite' : 'none'
})
```

---

## å››ã€é‡Œç¨‹ç¢‘ä¸éªŒæ”¶æ ‡å‡†

### 4.1 é‡Œç¨‹ç¢‘è®¡åˆ’

| é‡Œç¨‹ç¢‘ | æ—¶é—´ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|--------|------|--------|---------|
| **M1** | Week 3 | æ ¸å¿ƒç»„ä»¶+è®¾å¤‡ç®¡ç† | å¯è¿æ¥Modbusè®¾å¤‡å¹¶æ˜¾ç¤ºæ•°æ® |
| **M2** | Week 6 | Dashboardè®¾è®¡å™¨ | å¯æ‹–æ‹½è®¾è®¡è‡ªå®šä¹‰ä»ªè¡¨ç›˜ |
| **M3** | Week 9 | VSCodeé›†æˆ | å¯åœ¨VSCodeä¸­å®Œæ•´æ“ä½œé¡¹ç›® |
| **M4** | Week 12 | MVPå®Œæ•´ç‰ˆ | é€šè¿‡10åˆ†é’ŸéªŒæ”¶æµ‹è¯• |

### 4.2 MVPéªŒæ”¶æµ‹è¯•æµç¨‹

```
æµ‹è¯•åœºæ™¯ï¼šæ¸©åº¦ç›‘æ§é¡¹ç›®ï¼ˆ10åˆ†é’Ÿå†…å®Œæˆï¼‰

æ­¥éª¤1ï¼šæ–°å»ºé¡¹ç›® [< 1åˆ†é’Ÿ]
â”œâ”€â”€ æ‰“å¼€VSCode
â”œâ”€â”€ æ‰§è¡Œ "DAQ: New Project" å‘½ä»¤
â””â”€â”€ é€‰æ‹©"æ¸©åº¦ç›‘æ§"æ¨¡æ¿

æ­¥éª¤2ï¼šæ·»åŠ è™šæ‹Ÿä¼ æ„Ÿå™¨ [< 1åˆ†é’Ÿ]
â”œâ”€â”€ æ‰“å¼€è®¾å¤‡ç®¡ç†é¢æ¿
â”œâ”€â”€ ç‚¹å‡»"æ·»åŠ è®¾å¤‡"
â”œâ”€â”€ é€‰æ‹©"Mock Device"
â””â”€â”€ é…ç½®æ³¢å½¢ç±»å‹ä¸º"æ­£å¼¦æ³¢"

æ­¥éª¤3ï¼šé…ç½®é€»è¾‘èŠ‚ç‚¹ [< 3åˆ†é’Ÿ]
â”œâ”€â”€ æ‹–å…¥Mock DeviceèŠ‚ç‚¹
â”œâ”€â”€ æ‹–å…¥Threshold AlarmèŠ‚ç‚¹
â”œâ”€â”€ è¿æ¥ value â†’ input
â””â”€â”€ è®¾ç½®é˜ˆå€¼ä¸º30

æ­¥éª¤4ï¼šè®¾è®¡Dashboard [< 3åˆ†é’Ÿ]
â”œâ”€â”€ åˆ‡æ¢åˆ°Dashboardè®¾è®¡å™¨
â”œâ”€â”€ æ‹–å…¥LineChartæ§ä»¶
â”œâ”€â”€ æ‹–å…¥LEDæ§ä»¶
â”œâ”€â”€ ç»‘å®šæ•°æ®æº

æ­¥éª¤5ï¼šè¿è¡ŒéªŒè¯ [< 2åˆ†é’Ÿ]
â”œâ”€â”€ ç‚¹å‡»"è¿è¡Œ"æŒ‰é’®
â”œâ”€â”€ è§‚å¯Ÿæ³¢å½¢å›¾å®æ—¶æ›´æ–°
â”œâ”€â”€ éªŒè¯æ¸©åº¦>30æ—¶LEDå˜çº¢
â””â”€â”€ åœæ­¢è¿è¡Œï¼Œæ£€æŸ¥CSVæ–‡ä»¶
```

---

## äº”ã€æŠ€æœ¯æ ˆä¸ä¾èµ–

### 5.1 æ–°å¢ä¾èµ–

**Pythonåç«¯**ï¼š
```bash
pip install pymodbus>=3.0.0   # Modbusæ”¯æŒ
pip install flask>=2.0.0      # APIæœåŠ¡
pip install openai>=1.0.0     # AIé›†æˆï¼ˆå¯é€‰ï¼‰
```

**å‰ç«¯**ï¼š
```bash
npm install react-grid-layout  # Dashboardå¸ƒå±€
npm install zustand           # çŠ¶æ€ç®¡ç†
```

**VSCodeæ‰©å±•**ï¼š
```bash
npm install @vscode/webview-ui-toolkit
```

### 5.2 é¡¹ç›®ç»“æ„æ›´æ–°

```
accuDaq/
â”œâ”€â”€ visual-editor/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ DevicePanel.tsx      # æ–°å¢
â”‚       â”‚   â”œâ”€â”€ DashboardDesigner.tsx # æ–°å¢
â”‚       â”‚   â”œâ”€â”€ AIChat.tsx           # æ–°å¢
â”‚       â”‚   â””â”€â”€ widgets/
â”‚       â”‚       â”œâ”€â”€ LEDWidget.tsx    # æ–°å¢
â”‚       â”‚       â”œâ”€â”€ SwitchWidget.tsx # æ–°å¢
â”‚       â”‚       â””â”€â”€ NumberInput.tsx  # æ–°å¢
â”‚       â””â”€â”€ stores/
â”‚           â””â”€â”€ projectStore.ts      # æ–°å¢ï¼ˆZustandï¼‰
â”‚
â”œâ”€â”€ daq_core/
â”‚   â””â”€â”€ components/
â”‚       â”œâ”€â”€ modbus_client.py         # æ–°å¢
â”‚       â”œâ”€â”€ threshold_alarm.py       # æ–°å¢
â”‚       â”œâ”€â”€ debug_print.py           # æ–°å¢
â”‚       â””â”€â”€ global_variable.py       # æ–°å¢
â”‚
â”œâ”€â”€ vscode-extension/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ extension.ts             # æ›´æ–°
â”‚       â”œâ”€â”€ webviewProvider.ts       # æ–°å¢
â”‚       â””â”€â”€ commands.ts              # æ–°å¢
â”‚
â””â”€â”€ api/
    â”œâ”€â”€ server.py                    # æ–°å¢
    â””â”€â”€ ai_service.py                # æ–°å¢
```

---

## å…­ã€é£é™©ä¸åº”å¯¹

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|------|------|------|---------|
| Modbusè®¾å¤‡å…¼å®¹æ€§ | é«˜ | ä¸­ | å…ˆæ”¯æŒæ ‡å‡†åè®®ï¼Œæä¾›è°ƒè¯•å·¥å…· |
| VSCode Webviewæ€§èƒ½ | ä¸­ | ä¸­ | ä¼˜åŒ–æ¸²æŸ“ï¼Œè€ƒè™‘è™šæ‹ŸåŒ– |
| AI APIç¨³å®šæ€§ | ä½ | ä¸­ | é™çº§ä¸ºå¯é€‰åŠŸèƒ½ |
| è¿›åº¦å»¶æœŸ | ä¸­ | ä¸­ | AIè¾…åŠ©åŠŸèƒ½å¯å»¶å |

**ä¼˜å…ˆçº§è°ƒæ•´ç­–ç•¥**ï¼š
- ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»å®Œæˆï¼‰ï¼šç»„ä»¶åº“ã€è®¾å¤‡ç®¡ç†ã€Dashboardè®¾è®¡å™¨
- ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆå°½é‡å®Œæˆï¼‰ï¼šVSCodeé›†æˆã€åŒæ¨¡å¼
- ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆå¯å»¶åï¼‰ï¼šAIè¾…åŠ©ã€é«˜äº®è°ƒè¯•

---

## ä¸ƒã€ç¬¬äºŒé˜¶æ®µå®ŒæˆåçŠ¶æ€

### 7.1 ç»„ä»¶åº“å¯¹ç…§

| MVPè¦æ±‚ | ç¬¬ä¸€é˜¶æ®µ | ç¬¬äºŒé˜¶æ®µ |
|---------|---------|---------|
| æ¨¡æ‹Ÿä¿¡å·å‘ç”Ÿå™¨ | âœ… MockDevice | âœ… |
| Modbusè¯»å– | âŒ | âœ… ModbusClient |
| æ•°å­¦è¿ç®— | âœ… MathOperation | âœ… |
| æ¯”è¾ƒé€»è¾‘ | âœ… Compare | âœ… |
| é˜ˆå€¼æŠ¥è­¦ | âŒ | âœ… ThresholdAlarm |
| Debug Print | âŒ | âœ… DebugPrint |
| å…¨å±€å˜é‡ | âŒ | âœ… GlobalVariable |
| CSVå­˜å‚¨ | âœ… CSVStorage | âœ… |

### 7.2 åŠŸèƒ½å¯¹ç…§

| MVPè¦æ±‚ | å®ŒæˆçŠ¶æ€ |
|---------|---------|
| VSCodeæ‰©å±•å½¢æ€ | âœ… |
| .daqé¡¹ç›®æ–‡ä»¶ | âœ… |
| åŒæ¨¡å¼åˆ‡æ¢ | âœ…ï¼ˆå•å‘ï¼‰ |
| å¯è§†åŒ–ç”»å¸ƒç¼–è¾‘ | âœ… |
| è®¾å¤‡ç®¡ç†é¢æ¿ | âœ… |
| æ‹–æ‹½å¼Dashboard | âœ… |
| å˜é‡ç»‘å®š | âœ… |
| æœ¬åœ°è¿è¡Œ | âœ… |
| CSVå­˜å‚¨ | âœ… |
| AIè¾…åŠ© | âœ…ï¼ˆåŸºç¡€ç‰ˆï¼‰ |

---

## å…«ã€åç»­ç‰ˆæœ¬å±•æœ›ï¼ˆV3.0ï¼‰

ç¬¬äºŒé˜¶æ®µå®Œæˆåï¼Œåç»­å¯è€ƒè™‘ï¼š

1. **åŒå‘è½¬æ¢**ï¼šä»£ç  â†’ å¯è§†åŒ–å›¾
2. **æ›´å¤šåè®®**ï¼šOPC UA, CANopen
3. **é«˜çº§ç®—æ³•**ï¼šFFT, æ»¤æ³¢å™¨, PID
4. **äº‘å¹³å°**ï¼šè¿œç¨‹ç›‘æ§ã€æ•°æ®ä¸Šäº‘
5. **ç§»åŠ¨ç«¯**ï¼šReact Native Dashboard

---

## é™„å½•ï¼šå¿«é€Ÿå‚è€ƒ

### A. ç¼–è¯‘å™¨æ˜ å°„è¡¨æ›´æ–°

```python
# codegen.py - NODE_TYPE_MAPPING æ–°å¢
NODE_TYPE_MAPPING = {
    # ç°æœ‰
    "daq:mock_device": "MockDevice",
    "daq:mqtt_subscribe": "MQTTSubscriber",
    "daq:mqtt_publish": "MQTTPublisher",
    "daq:math": "MathOperation",
    "daq:compare": "Compare",
    "daq:csv_storage": "CSVStorage",

    # ç¬¬äºŒé˜¶æ®µæ–°å¢
    "daq:modbus_tcp": "ModbusClient",
    "daq:threshold_alarm": "ThresholdAlarm",
    "daq:debug_print": "DebugPrint",
    "daq:global_variable": "GlobalVariable",
}
```

### B. æ¯å‘¨äº¤ä»˜æ£€æŸ¥è¡¨

**Week 1-3**:
- [ ] ThresholdAlarmç»„ä»¶å®ç°å¹¶æµ‹è¯•
- [ ] DebugPrintç»„ä»¶å®ç°å¹¶æµ‹è¯•
- [ ] GlobalVariableç»„ä»¶å®ç°å¹¶æµ‹è¯•
- [ ] ModbusClientç»„ä»¶å®ç°å¹¶æµ‹è¯•
- [ ] DevicePanel.tsx å®Œæˆ
- [ ] è®¾å¤‡ç®¡ç†APIæ¥å£

**Week 4-6**:
- [ ] react-grid-layouté›†æˆ
- [ ] LEDWidgetå®ç°
- [ ] SwitchWidgetå®ç°
- [ ] NumberInputå®ç°
- [ ] å˜é‡ç»‘å®šç³»ç»Ÿ
- [ ] Dashboardé…ç½®ä¿å­˜/åŠ è½½

**Week 7-9**:
- [ ] VSCodeæ‰©å±•Webviewé›†æˆ
- [ ] å‘½ä»¤æ³¨å†Œï¼ˆnew/open/compile/runï¼‰
- [ ] åŒæ¨¡å¼åˆ‡æ¢UI
- [ ] ä»£ç ç”Ÿæˆä¼˜åŒ–

**Week 10-12**:
- [ ] AI Chatä¾§è¾¹æ 
- [ ] LLM APIé›†æˆ
- [ ] é«˜äº®æ‰§è¡Œæ¨¡å¼
- [ ] MVPéªŒæ”¶æµ‹è¯•é€šè¿‡

---

**æ–‡æ¡£ç»“æŸ**

*accuDaqå¼€å‘å›¢é˜Ÿ | 2026-01-21*
