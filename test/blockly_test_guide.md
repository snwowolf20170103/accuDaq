# Blockly 积木块测试指南

## 🎯 测试目标

验证 Custom Script 编辑器中的 Blockly 积木块是否完整集成并正常工作。

---

## 📋 测试前准备

1. **启动开发服务器**
   ```bash
   cd visual-editor
   npm run dev
   ```
   访问：http://localhost:3003/

2. **创建测试节点**
   - 在画布上添加一个 **Custom Script** 节点
   - 点击节点进入编辑模式
   - 打开 Blockly 编辑器弹窗

---

## ✅ 积木块分类清单

### 1️⃣ DAQ 专用 (2个积木)
**颜色**: 🔴 #A65C5C

| 积木块 | 功能 | 测试方法 |
|--------|------|----------|
| 📥 读取输入 | 读取 input1/input2 端口的值 | 拖拽到画布，选择端口 |
| 📤 设置输出 | 设置 output1 端口的值 | 连接数值，验证输出 |

**测试用例**：
```blockly
设置输出 output1 为 [读取输入 input1] × 2
```

预期生成代码：
```python
set_output("output1", get_input("input1") * 2)
```

---

### 2️⃣ 逻辑 (10个积木)
**颜色**: 🔵 #5C81A6

| 积木块 | 功能 |
|--------|------|
| ❓ if/do | 条件判断 |
| ❓ if/do/else | 条件分支 |
| ⚖️ 比较 (=) | 等于判断 |
| ⚖️ 比较 (<) | 小于判断 |
| ⚖️ 比较 (>) | 大于判断 |
| 🔗 and/or | 逻辑与/或 |
| ❌ not | 逻辑非 |
| ✔️ true/false | 布尔值 |
| ∅ null | 空值 |
| ❔ ? : | 三元表达式 |

**测试用例**：
```blockly
如果 [读取输入 input1] > [30] 则
  设置输出 output1 为 [100]
否则
  设置输出 output1 为 [0]
```

---

### 3️⃣ 循环 (5个积木)
**颜色**: 🟢 #5CA68D

| 积木块 | 功能 | 测试要点 |
|--------|------|----------|
| 🔁 重复 N 次 | 循环执行 N 次 | 验证计数器 |
| ⏸️ while/until | 条件循环 | 验证终止条件 |
| 🔢 for 循环 | 带计数的循环 | 验证变量递增 |
| 📋 遍历列表 | 遍历数组 | 验证迭代器 |
| 🛑 break/continue | 流程控制 | 验证跳出/继续 |

**测试用例**：
```blockly
将 [0] 赋值给 sum
重复 [10] 次
  将 [sum] + [1] 赋值给 sum
设置输出 output1 为 sum
```

---

### 4️⃣ 数学 (12个积木)
**颜色**: 🟢 #5CA65C

| 积木块 | 功能 |
|--------|------|
| 🔢 数字 | 输入数值 |
| ➕ 四则运算 | +、-、×、÷ |
| 🧮 数学函数 | 平方根、绝对值、ln、log10、e^、10^ |
| 📐 三角函数 | sin、cos、tan、asin、acos、atan |
| 🔣 数学常量 | π、e、φ、√2、√½、∞ |
| 🔍 数字属性 | 偶数、奇数、质数、整数、正数、负数、整除 |
| 🎲 取整 | 向上、向下、四舍五入 |
| 📊 列表运算 | sum、min、max、average、median、mode |
| ➗ 取余 | 模运算 |
| 🎯 约束范围 | 限制在 min~max |
| 🎰 随机整数 | 随机数生成 |
| 🎲 随机小数 | 0~1 随机数 |

**测试用例**：
```blockly
设置输出 output1 为 对 [读取输入 input1] 求 [平方根]
```

---

### 5️⃣ 文本 (11个积木)
**颜色**: 🟦 #5BA58C

| 积木块 | 功能 |
|--------|------|
| 📝 文本 | 输入字符串 |
| ➕ 拼接文本 | 多个字符串合并 |
| 📎 追加文本 | 向变量追加 |
| 📏 文本长度 | 字符串长度 |
| ❓ 文本为空 | 判断是否为空 |
| 🔍 查找位置 | 查找子串索引 |
| 📌 获取字符 | 获取第N个字符 |
| ✂️ 截取文本 | 子串提取 |
| 🔤 大小写转换 | UPPER、lower、Title |
| ✂️ 去除空格 | trim、左trim、右trim |
| 🖨️ 打印 | 输出文本 |

**测试用例**：
```blockly
拼接文本 ["温度: "] [读取输入 input1] ["°C"]
```

---

### 6️⃣ 列表 (11个积木)
**颜色**: 🟣 #745CA6

| 积木块 | 功能 |
|--------|------|
| 📋 创建列表 | 创建数组 |
| 📋 空列表 | 空数组 |
| 🔁 重复列表 | 重复N次创建 |
| 📏 列表长度 | 数组长度 |
| ❓ 列表为空 | 判断是否为空 |
| 🔍 查找位置 | 查找元素索引 |
| 📌 获取元素 | 获取第N项 |
| ✏️ 设置元素 | 设置第N项 |
| ✂️ 截取列表 | 子数组 |
| 🔀 分割/合并 | split、join |
| 🔃 排序 | 升序、降序、随机 |

**测试用例**：
```blockly
将 [创建列表 1, 2, 3, 4, 5] 赋值给 myList
将 获取列表 [myList] 的第 [1] 项 赋值给 first
```

---

### 7️⃣ 变量 (动态)
**颜色**: 🟣 #A65C81

| 积木块 | 功能 |
|--------|------|
| 📦 创建变量 | 创建新变量 |
| 📌 获取变量 | 读取变量值 |
| ✏️ 设置变量 | 赋值 |
| ➕ 变量增加 | 累加 |

**测试用例**：
```blockly
将 [读取输入 input1] 赋值给 temp
如果 [temp] > [50] 则
  将 [100] 赋值给 alarm
否则
  将 [0] 赋值给 alarm
设置输出 output1 为 alarm
```

---

### 8️⃣ 函数 (动态)
**颜色**: 🟣 #9A5CA6

| 积木块 | 功能 |
|--------|------|
| ⚙️ 定义函数 | 创建自定义函数 |
| ▶️ 调用函数 | 执行函数 |
| 🔙 返回值 | 函数返回 |

**测试用例**：
```blockly
定义函数 [double] 参数 [x]
  返回 [x] × [2]

设置输出 output1 为 调用 double([读取输入 input1])
```

---

## 🧪 完整测试场景

### 场景 1: 温度报警系统
```blockly
将 [读取输入 input1] 赋值给 temperature

如果 [temperature] > [80] 则
  设置输出 output1 为 [2]  // 严重报警
如果 [temperature] > [60] 则
  设置输出 output1 为 [1]  // 一般报警
否则
  设置输出 output1 为 [0]  // 正常
```

### 场景 2: 数据平滑处理
```blockly
将 [创建空列表] 赋值给 buffer
重复 [5] 次
  将 [读取输入 input1] 添加到 [buffer] 末尾

将 对列表 [buffer] 求 [平均值] 赋值给 smoothed
设置输出 output1 为 smoothed
```

### 场景 3: 字符串格式化
```blockly
拼接文本 ["传感器读数: "] [读取输入 input1] ["V, 状态: "]
  如果 [读取输入 input1] > [5] 则 ["正常"] 否则 ["低电压"]
```

---

## 📊 测试结果记录

### ✅ 功能测试清单

| 分类 | 积木数量 | 测试状态 | 问题 |
|------|---------|---------|------|
| DAQ 专用 | 2 | ⬜ 待测试 | |
| 逻辑 | 10 | ⬜ 待测试 | |
| 循环 | 5 | ⬜ 待测试 | |
| 数学 | 12 | ⬜ 待测试 | |
| 文本 | 11 | ⬜ 待测试 | |
| 列表 | 11 | ⬜ 待测试 | |
| 变量 | 4 | ⬜ 待测试 | |
| 函数 | 3 | ⬜ 待测试 | |

**总计**: 58 个积木块

---

## 🐛 已知问题

（测试后填写）

---

## 📝 测试结论

（测试后填写）

---

## 🔗 相关文档

- [Blockly 官方文档](https://developers.google.com/blockly)
- [Python 代码生成器文档](https://developers.google.com/blockly/guides/create-custom-blocks/generating-code)
- [accuDaq 架构文档](../CLAUDE.md)
